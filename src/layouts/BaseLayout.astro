---
import BaseHead from '@components/BaseHead.astro';
import Header from '@components/Header.astro';
import Footer from '@components/Footer.astro';
import '@styles/global.css';

interface Props {
  title: string;
  description: string;
  ogImage?: string;
}

const { title, description, ogImage } = Astro.props;
---

<!doctype html>
<html lang={Astro.currentLocale ?? 'en'}>
  <head>
    <BaseHead title={title} description={description} ogImage={ogImage} />
  </head>
  <body class="flex min-h-screen flex-col bg-bg-primary text-text-primary">
    <Header />
    <main class="flex-1">
      <slot />
    </main>
    <Footer />
  </body>
</html>

<script>
  function initScrollAnimations() {
    const elements = document.querySelectorAll('[data-animate]:not(.is-visible)');
    if (!elements.length) return;

    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            entry.target.classList.add('is-visible');
            observer.unobserve(entry.target);
          }
        });
      },
      { threshold: 0.1, rootMargin: '0px 0px -40px 0px' }
    );

    elements.forEach((el) => observer.observe(el));
  }

  function initHeaderScroll() {
    const header = document.getElementById('site-header');
    if (!header) return;

    function onScroll() {
      header!.classList.toggle('scrolled', window.scrollY > 20);
    }

    onScroll();
    window.addEventListener('scroll', onScroll, { passive: true });
  }

  // Run on initial load and after view transitions
  initScrollAnimations();
  initHeaderScroll();

  document.addEventListener('astro:after-swap', () => {
    initScrollAnimations();
    initHeaderScroll();
  });
</script>
